<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="keywords" content="Derry World, Travel, Explore" />
    <meta name="description" content="Register to Derry World and start exploring today!" />
    <meta name="author" content="Derry World" />
    <link rel="shortcut icon" href="/images/favicon.png" type="image/png" />
    <title>Register - Derry World</title>
    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <style>
      .login-container {
        background-color: #fff;
        color: #000;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 40px;
        max-width: 550px;
        margin: 50px auto;
        width: 95%;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .login-container {
          padding: 30px 20px;
          margin: 20px auto;
          width: 90%;
        }
        
        .btn-login, .btn-register, .btn-google {
          padding: 12px;
          font-size: 14px;
        }
        
        h2 {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .login-container {
          padding: 20px 15px;
          margin: 10px auto;
          width: 95%;
        }
        
        .form-control {
          font-size: 14px;
        }
        
        .btn-login, .btn-register, .btn-google {
          padding: 10px;
          font-size: 13px;
          height: 45px;
        }
      }

      .login-container h2 {
        color: #000;
        margin-bottom: 20px;
      }

      .login-container label {
        font-weight: bold;
      }

      .btn-login {
        background-color: #ffbe33;
        color: #000;
        border: none;
        padding: 15px;
        height: 50px;
        border-radius: 5px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s ease;
      }

      .btn-login:hover {
        background-color: #e5ab2e;
      }

      .btn-register {
        background-color: #ffbe33;
        color: #000;
        border: none;
        padding: 15px;
        height: 50px;
        border-radius: 5px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s ease;
      }

      .btn-register:hover {
        background-color: #e5ab2e;
      }

      .btn-google {
        background-color: #fff;
        color: #000;
        border: 1px solid #ddd;
        padding: 15px;
        font-weight: 500;
        transition: all 0.3s ease;
        width: 100%;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 5px;
        height: 50px;
      }

      .btn-google:hover {
        background-color: #f8f9fa;
        border-color: #ddd;
        text-decoration: none;
        color: #000;
      }

      .btn-google img {
        width: 18px;
        height: 18px;
        margin-right: 10px;
      }

      .divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 20px 0;
      }

      .divider::before,
      .divider::after {
        content: '';
        flex: 1;
        border-bottom: 1px solid #dadce0;
      }

      .divider span {
        padding: 0 10px;
        color: #5f6368;
        font-size: 14px;
      }

      .password-field {
        position: relative;
      }

      .password-toggle {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #5f6368;
      }

      .form-control {
        padding-right: 40px;
      }
    </style>
  </head>
  <body>
    <div class="hero_area">
      <div class="bg-box">
        <img src="/images/hero-bg.jpg" alt="Background Image" class="img-fluid" />
      </div>
      <header class="header_section">
        <div class="container">
          <nav class="navbar navbar-expand-lg custom_nav-container">
            <a class="navbar-brand" href="/">
              <span>Derry World</span>
            </a>
          </nav>
        </div>
      </header>
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-6 col-md-8 col-sm-12">
            <div class="login-container">
              <h2 class="text-center mb-4">Register</h2>
              <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-danger" role="alert">
                  <%= error %>
                </div>
              <% } %>
              <form id="registerForm" method="POST" action="/register" novalidate>
                <div class="form-group mb-3">
                  <label for="name">Full Name</label>
                  <input type="text" 
                         class="form-control" 
                         id="name" 
                         name="name" 
                         value="<%= typeof formData !== 'undefined' ? formData.name : '' %>"
                         required>
                </div>
                <div class="form-group mb-3">
                  <label for="email">Email address</label>
                  <input type="email" 
                         class="form-control" 
                         id="email" 
                         name="email" 
                         value="<%= typeof formData !== 'undefined' ? formData.email : '' %>"
                         required>
                </div>
                <div class="form-group mb-3">
                  <label for="phone">Phone Number</label>
                  <input type="tel" 
                         class="form-control" 
                         id="phone" 
                         name="phone" 
                         value="<%= typeof formData !== 'undefined' ? formData.phone : '' %>"
                         pattern="[0-9]{10}"
                         title="Please enter a valid 10-digit phone number"
                         required>
                </div>
                <div class="form-group mb-3">
                  <label for="password">Password</label>
                  <div class="password-field">
                    <input type="password" 
                           class="form-control" 
                           id="password" 
                           name="password" 
                           minlength="8"
                           pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
                           title="Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character (@$!%*?&)"
                           required>
                    <button type="button" 
                            class="password-toggle" 
                            onclick="togglePassword('password', 'passwordToggle')"
                            aria-label="Toggle password visibility">
                      <i id="passwordToggle" class="fas fa-eye"></i>
                    </button>
                  </div>
                  <small class="form-text text-muted">
                    Password must contain: 8+ characters, uppercase letter, lowercase letter, number, and special character (@$!%*?&)
                  </small>
                </div>
                <div class="form-group mb-3">
                  <label for="confirmPassword">Confirm Password</label>
                  <div class="password-field">
                    <input type="password" 
                           class="form-control" 
                           id="confirmPassword" 
                           name="confirmPassword" 
                           minlength="8"
                           required>
                    <button type="button" 
                            class="password-toggle" 
                            onclick="togglePassword('confirmPassword', 'confirmPasswordToggle')"
                            aria-label="Toggle confirm password visibility">
                      <i id="confirmPasswordToggle" class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
                <div class="form-group mb-3">
                  <label for="referralCode">Have a Referral Code? (Optional)</label>
                  <input type="text" 
                         class="form-control" 
                         id="referralCode" 
                         name="referralCode" 
                         placeholder="Enter referral code"
                         pattern="[A-Za-z0-9]{6,10}"
                         title="Referral code should be 6-10 characters long">
                  <small class="form-text text-muted">Enter a valid referral code to get rewards</small>
                </div>

                <button type="submit" class="btn btn-register w-100">Register</button>
              </form>

              <div class="divider">
                <span>OR</span>
              </div>

              <a href="/auth/google" class="btn btn-google">
                <img src="https://www.google.com/favicon.ico" alt="Google" />
                Sign up with Google
              </a>

              <div class="text-center mt-4">
                <p>Already have an account? <a href="/login">Login here</a></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Core Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
    function validateForm() {
      const rawName = document.getElementById('name').value;
      const name = rawName.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const phone = document.getElementById('phone').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // Regex patterns
      const nameRegex = /^[A-Za-z][A-Za-z\s]*$/;
      const emailStartRegex = /^[A-Za-z]/;
      const emailFormatRegex = /^[\w-]+(\.\w+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/;
      const phoneRegex = /^\d{10}$/;

      // Name validation
      if (!rawName || rawName[0] === ' ') {
        Swal.fire({
          icon: 'error',
          title: 'Invalid Name',
          text: 'Name cannot start with a space.'
        });
        return false;
      }

      if (!nameRegex.test(name)) {
        Swal.fire({
          icon: 'error',
          title: 'Invalid Name',
          text: 'Name must start with a letter and contain only letters and spaces.'
        });
        return false;
      }

      // Email validation
      if (!emailStartRegex.test(email)) {
        Swal.fire({
          icon: 'error',
          title: 'Invalid Email',
          text: 'Email must start with a letter'
        });
        return false;
      }

      if (!emailFormatRegex.test(email)) {
        Swal.fire({
          icon: 'error',
          title: 'Invalid Email Format',
          text: 'Please enter a valid email address'
        });
        return false;
      }

      // Phone validation
      if (!phoneRegex.test(phone)) {
        Swal.fire({
          icon: 'error',
          title: 'Invalid Phone',
          text: 'Phone number must be exactly 10 digits'
        });
        return false;
      }

      // Strong password validation
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
      if (!passwordRegex.test(password)) {
        Swal.fire({
          icon: 'error',
          title: 'Weak Password',
          text: 'Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character (@$!%*?&)'
        });
        return false;
      }

      // Password match validation
      if (password !== confirmPassword) {
        Swal.fire({
          icon: 'error',
          title: 'Password Mismatch',
          text: 'Password and confirm password do not match'
        });
        return false;
      }

      return true;
    }

    document.getElementById('registerForm').addEventListener('submit', function(event) {
      if (!validateForm()) {
        event.preventDefault();
      }
    });

      function togglePassword(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);

        if (input.type === 'password') {
          input.type = 'text';
          toggle.classList.remove('fa-eye');
          toggle.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          toggle.classList.remove('fa-eye-slash');
          toggle.classList.add('fa-eye');
        }
      }


    </script>
  </body>
</html>