<%- include('../../views/partials/user/header-no-bg', { user, cartCount, title }) %>

    <div class="container my-5">
        <div class="wishlist-header text-center mb-5">
            <h2 class="display-6 fw-bold">My Wishlist</h2>
            <div class="text-muted mt-2">
                <i class="fas fa-times text-danger me-2"></i>
                <span><%= wishlistItems.length %> items saved</span>
            </div>
        </div>

        <% if (wishlistItems && wishlistItems.length > 0) { %>
            <div class="row g-4" id="wishlist-items-container">
                <% wishlistItems.forEach(function(item) { %>
                    <div class="col-lg-3 col-md-4 col-sm-6 wishlist-item" data-item-id="<%= item._id %>">
                        <div class="wishlist-card">
                            <div class="image-container position-relative">
                                <a href="/food/<%= item._id %>" class="product-link">
                                    <img src="<%= item.productImage && item.productImage.length > 0 ? item.productImage[0] : '/images/default-product.jpg' %>" 
                                         alt="<%= item.name %>"
                                         class="product-image">
                                </a>
                                <button class="btn btn-danger btn-sm delete-btn position-absolute"
                                        onclick="removeFromWishlist('<%= item._id %>')"
                                        title="Remove from Wishlist">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="card-content">
                                <h5 class="product-name"><%= item.name %></h5>
                                <p class="product-description"><%= item.description %></p>
                                <div class="price-container">
                                    <div class="price-wrapper">
                                        <span class="regular-price text-decoration-line-through text-muted me-2">₹<%= item.regularPrice.toFixed(2) %></span>
<% if (item.offerDetails && item.offerDetails.finalPrice) { %>
  <span class="sale-price">₹<%= item.offerDetails.finalPrice.toFixed(2) %></span>
<% } else if (item.salesPrice && item.salesPrice < item.regularPrice) { %>
  <span class="sale-price">₹<%= item.salesPrice.toFixed(2) %></span>
<% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="empty-wishlist">
                <div class="empty-content">
                    <div class="empty-icon mb-4">
                        <i class="far fa-heart"></i>
                    </div>
                    <h3 class="fw-semibold mb-3">No Saved Items</h3>
                    <p class="text-muted mb-4">Your wishlist is currently empty. Discover our curated selection of dishes and save your favorites for later.</p>
                    <a href="/menu" class="btn btn-primary explore-btn">
                        View Menu
                    </a>
                </div>
            </div>
        <% } %>
    </div>


<style>
.wishlist-page {
    background-color: #f8f9fa;
    min-height: calc(100vh - 80px);
}

.wishlist-header h2 {
    color: #2c3e50;
    font-family: 'Poppins', sans-serif;
}

.wishlist-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.wishlist-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.image-container {
    position: relative;
    padding-top: 75%;
    overflow: hidden;
}

.product-link {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    text-decoration: none;
    color: inherit;
}

.product-link:hover .product-image {
    transform: scale(1.1);
}

.product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.delete-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 2;
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
}

.wishlist-card:hover .delete-btn {
    opacity: 1;
    transform: translateY(0);
}

.delete-btn:hover {
    transform: scale(1.1);
    background-color: #c82333;
    border-color: #bd2130;
}

.card-content {
    padding: 1.5rem;
}

.product-name {
    font-size: 1.1rem;
    color: #2c3e50;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.product-description {
    font-size: 0.9rem;
    color: #7f8c8d;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

.price-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.price-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
}

.regular-price {
    color: #6c757d;
    font-size: 0.95rem;
}

.sale-price {
    color: #ffbe33;
    font-weight: 600;
    font-size: 1.1rem;
}

.empty-wishlist {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    margin: 2rem auto;
    max-width: 500px;
    border: 1px solid #eaecef;
}

.empty-content {
    padding: 3rem 2rem;
    text-align: center;
}

.empty-icon {
    color: #e0e4e9;
    margin-bottom: 1.5rem;
}

.empty-icon i {
    font-size: 3.5rem;
}

.empty-content h3 {
    color: #1a1f36;
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
}

.empty-content p {
    color: #4a5568;
    font-size: 0.95rem;
    line-height: 1.6;
    max-width: 380px;
    margin: 0 auto 1.5rem;
}

.explore-btn {
    background: #2d3748;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 6px;
    font-size: 0.95rem;
    font-weight: 500;
    letter-spacing: 0.3px;
    transition: all 0.2s ease;
}

.explore-btn:hover {
    background: #1a202c;
    transform: translateY(-1px);
}

.explore-btn:active {
    transform: translateY(0);
}

.wishlist-card .price-container {
    margin: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.wishlist-card .price-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
}

.wishlist-card .card-content {
    padding: 15px;
}

.wishlist-card .product-name {
    margin-bottom: 8px;
    font-size: 1.1rem;
    font-weight: 600;
}

.wishlist-card .product-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

@media (max-width: 768px) {
    .wishlist-card {
        margin-bottom: 1rem;
    }
    
    .card-content {
        padding: 1rem;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
async function removeFromWishlist(productId) {
    const result = await Swal.fire({
        title: 'Remove from Wishlist?',
        text: 'Are you sure you want to remove this item from your wishlist?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, remove it',
        cancelButtonText: 'Cancel'
    });

    if (result.isConfirmed) {
        const response = await fetch(`/wishlist/remove/${productId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        const data = await response.json();

        if (data.success) {
            const itemElement = document.querySelector(`[data-item-id="${productId}"]`);
            if (itemElement) {
                itemElement.style.transition = 'all 0.3s ease';
                itemElement.style.transform = 'scale(0.9)';
                itemElement.style.opacity = '0';
                setTimeout(() => {
                    itemElement.remove();
                    // Update wishlist count
                    const countElement = document.querySelector('.wishlist-header .text-muted span');
                    if (countElement) {
                        const currentCount = parseInt(countElement.textContent) || 0;
                        if (currentCount > 0) {
                            countElement.textContent = `${currentCount - 1} items saved`;
                        }
                    }
                    // Check if wishlist is empty
                    const wishlistContainer = document.getElementById('wishlist-items-container');
                    if (!wishlistContainer.children.length) {
                        window.location.reload();
                    }
                }, 300);
            }
            // Show success notification
            const Toast = Swal.mixin({
                toast: true,
                position: 'top',
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
                customClass: { popup: 'colored-toast' }
            });
            Toast.fire({ icon: 'success', title: 'Removed from wishlist' });
            // Update wishlist count in header
            const wishlistCountElement = document.getElementById('wishlistCount');
            if (wishlistCountElement) {
                const currentCount = parseInt(wishlistCountElement.textContent) || 0;
                if (currentCount > 0) {
                    wishlistCountElement.textContent = currentCount - 1;
                }
            }
        } else {
            Swal.fire({
                title: 'Error!',
                text: data.message || 'Failed to remove item from wishlist.',
                icon: 'error',
            });
        }
    }
}
</script>
<%- include('../../views/partials/user/footer') %>